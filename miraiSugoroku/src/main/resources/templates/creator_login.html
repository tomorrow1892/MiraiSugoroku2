<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ログイン</title>
    <link rel="stylesheet" th:href="@{/css/page_login.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/display.css}">
    <!-- bootstrapを使用する際には下２行を追加 -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.2/css/bootstrap.min.css}">
    <script th:src="@{/webjars/bootstrap/5.1.2/js/bootstrap.min.js}" type="text/javascript"></script>

    <script>
        $(function () {
            var textfield = $("input[name=user]");
            $('button[type="submit"]').click(function (e) {
                e.preventDefault();
                //little validation just to check username
                if (textfield.val() != "") {
                    //$("body").scrollTo("#output");
                    $("#output").addClass("alert alert-success animated fadeInUp").html("Welcome back " + "<span style='text-transform:uppercase'>" + textfield.val() + "</span>");
                    $("#output").removeClass(' alert-danger');
                    $("input").css({
                        "height": "0",
                        "padding": "0",
                        "margin": "0",
                        "opacity": "0"
                    });
                    //change button text
                    $('button[type="submit"]').html("continue")
                        .removeClass("btn-info")
                        .addClass("btn-default").click(function () {
                            $("input").css({
                                "height": "auto",
                                "padding": "10px",
                                "opacity": "1"
                            }).val("");
                        });

                    //show avatar
                    $(".avatar").css({
                        "background-image": "url('http://api.randomuser.me/0.3.2/portraits/women/35.jpg')"
                    });
                } else {
                    //remove success mesage replaced with error message
                    $("#output").removeClass(' alert alert-success');
                    $("#output").addClass("alert alert-danger animated fadeInUp").html("sorry enter a username ");
                }
                //console.log(textfield.val());

            });
        });

    </script>

</head>

<body class="body">
    <!-- ヘッダー -->
    <div th:replace="header :: header"></div>
    <!-- ログインフォーム -->
    <div class="container">
        <div class="login-container">
            <div id="output"></div>

            <div class="form-box">
                <form th:action="@{/login/}" method="post" th:object="${creatorLoginForm}">
                    <p style="    font-weight: bold; color: #6091d3;">イベントの年度を選んでください</p>
                    <!--/* 年度選択のドロップダウン */-->
                    <p>
                        <select id="selectedYear" name="selectedYear">
                            <option th:each="y: ${years}" th:value="${y}" th:text="${y}"
                                th:selected="${y == creatorLoginForm.selectedYear}">
                            </option>
                        </select>
                    </p>
                    <p style="    font-weight: bold; color: #6091d3;">参加イベントを選択してください。</p>
                    <!--/* イベント選択のドロップダウン */-->
                    <p>
                        <select id="selectedEventId" name="selectedEventId" th:required="required">

                            <option value="" class="form-control">- イベントを選択してください -</option>

                        </select>
                    </p>
                    <p style="    font-weight: bold; color: #6091d3;">ログインIDを入力してください。</p>
                    <p><input type="text" th:field="*{loginId}" class="form-control" th:required="required" /></p>

                    <p><button class="btn btn-info btn-block login" type="submit">ログイン</button></p>

                </form>
            </div>
        </div>

    </div>

</body>
<script th:inline="javascript">
    const dropdownYear = document.getElementById("selectedYear");
    const dropdownEvent = document.getElementById("selectedEventId");
    const eventDropDownChange = () => {
        const selectedYear = dropdownYear.value;
        const allEvents = /*[[${events}]]*/ null;

        while (dropdownEvent.children[1]) {//"イベントを選択してください"以外の要素をすべて削除
            dropdownEvent.removeChild(dropdownEvent.children[1]);
        }
        console.log(allEvents);
        allEvents.forEach(event => {
            let option = document.createElement("option");
            let date = new Date(event["startDate"]);
            if (date.getFullYear() == selectedYear) {//年度選択のドロップダウンの年度に該当するイベントをリストに入れる
                console.log(event["name"]);
                option.text = event["name"];
                option.value = event["eventId"];
                dropdownEvent.appendChild(option);
            }
        });
    }
    eventDropDownChange();//最初に一回実行
    dropdownYear.addEventListener("change", (event) => eventDropDownChange());

</script>


</html>